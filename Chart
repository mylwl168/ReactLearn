import React from "react";
import { Chart as ChartJS, BarElement, CategoryScale, LinearScale, Tooltip, Title } from "chart.js";
import { Bar } from "react-chartjs-2";

ChartJS.register(BarElement, CategoryScale, LinearScale, Tooltip, Title);

const data = {
  labels: ["A", "B", "C", "D", "E"],
  datasets: [
    {
      label: "Dataset 1",
      data: [12, 19, 3, 5, 2],
      backgroundColor: "rgba(75, 192, 192, 0.6)",
    },
  ],
};

const options = {
  responsive: true,
  plugins: {
    legend: { display: false },
  },
  scales: {
    x: {
      ticks: {
        color: "black", // 文字颜色黑色
        font: {
          weight: "bold",
        },
      },
    },
  },
};

const BlackBoxPlugin = {
  id: "blackBox",
  beforeDraw: (chart: any) => {
    const ctx = chart.ctx;
    const xAxis = chart.scales.x;
    if (!xAxis) return;

    const boxHeight = 24; // 底部矩形边框的高度
    const lineWidth = xAxis.options.grid.lineWidth || 1; // X 轴的线宽

    // 计算边框的范围
    const left = xAxis.left;
    const right = xAxis.right;
    const top = xAxis.top + lineWidth / 2; // 让边框紧贴 X 轴
    const bottom = top + boxHeight;

    // 绘制透明填充的黑色矩形边框
    ctx.strokeStyle = "black";
    ctx.lineWidth = lineWidth;
    ctx.strokeRect(left, top, right - left, boxHeight);

    // 绘制垂直分割线
    xAxis.ticks.forEach((_tick: any, index: number) => {
      if (index === 0) return; // 忽略最左侧的 Y 轴（避免多余的线）
      const x = xAxis.getPixelForTick(index);

      ctx.beginPath();
      ctx.moveTo(x, top); // 从黑框顶部开始
      ctx.lineTo(x, bottom); // 画到底部
      ctx.stroke();
    });
  },
};

const BarChart = () => {
  return <Bar data={data} options={options} plugins={[BlackBoxPlugin]} />;
};

export default BarChart;

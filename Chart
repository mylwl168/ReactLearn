const BlackBoxPlugin = {
  id: "blackBox",
  beforeDraw: (chart: Chart) => {
    const { ctx, scales: { x }, chartArea } = chart;
    
    // 🎯 X軸のラベルエリアの高さを決定
    const boxHeight = 20; // すべてのラベルに統一の高さを設定
    const yBottom = x.bottom + boxHeight; // X軸の下にボックスを配置

    ctx.save(); // 🎯 現在の描画状態を保存

    // 🎯 各ラベルの下に黒いボックスを描画
    x.ticks.forEach((tick, index) => {
      const xLeft = x.getPixelForTick(index); // 現在のラベルのX座標
      const xRight = index < x.ticks.length - 1 
        ? x.getPixelForTick(index + 1) 
        : chartArea.right; // 最後のラベルは右端まで広げる

      // 🔳 黒いボックスの描画（透明な背景 + 黒い枠線）
      ctx.fillStyle = "transparent"; // 内部は透明
      ctx.fillRect(xLeft, x.bottom, xRight - xLeft, boxHeight);

      ctx.strokeStyle = "black"; // 枠線を黒に設定
      ctx.lineWidth = x.grid.lineWidth; // X軸の太さと統一
      ctx.strokeRect(xLeft, x.bottom, xRight - xLeft, boxHeight);
    });

    // 🎯 X軸の下に1本の分割線を引く（連続的なボックスにするため）
    ctx.strokeStyle = "black";
    ctx.lineWidth = x.grid.lineWidth;
    ctx.beginPath();
    ctx.moveTo(chartArea.left, yBottom);
    ctx.lineTo(chartArea.right, yBottom);
    ctx.stroke();

    ctx.restore(); // 🎯 描画状態を元に戻す
  },
};

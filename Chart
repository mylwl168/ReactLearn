import jsPDF from "jspdf";
import autoTable from "jspdf-autotable";

const doc = new jsPDF();

// 第一个 autotable 示例
autoTable(doc, {
  head: [["列1", "列2", "列3"]],
  body: Array(50).fill(["数据1", "数据2", "数据3"]),
  margin: { top: 20 }
});

// 记录第一个表格绘制结束后的 Y 坐标
const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : 20;

// 为第二个 autotable 预留间距后设置 startY
const secondTableStartY = finalY + 10;

// 记录调用第二个表格前的页码，作为第二个表格的起始页
const secondTableStartPage = doc.internal.getNumberOfPages();

// 第二个 autotable，分页时在每页上方添加一行文本
autoTable(doc, {
  startY: secondTableStartY,
  head: [["列A", "列B", "列C"]],
  body: Array(50).fill(["数据A", "数据B", "数据C"]),
  margin: { top: 20 },
  didDrawPage: (data) => {
    doc.setFontSize(12);
    let headerY;
    // 如果当前页是第二个表格的起始页，则使用 data.settings.startY（即第二个表格真正开始的位置）
    if (data.pageNumber === secondTableStartPage) {
      headerY = data.settings.startY - 10;
    } else {
      // 分页后的其他页，则使用页边距 top（因为 data.settings.startY 仍然保持着第一页时的值）
      headerY = data.settings.margin.top - 10;
    }
    doc.text("第二个表格上方的说明文本", data.settings.margin.left, headerY);
  }
});

doc.save("table.pdf");
